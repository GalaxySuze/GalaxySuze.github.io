<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>张阿简博客</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="description" content="Kill Time, Or Kiss Time"/>
<meta name="keywords" content="Kill Time, Or Kiss Time"/>
<link rel="shortcut icon" href="https://zhangajian.com/favicon.ico">
<link rel="stylesheet" href="https://zhangajian.com/styles/main.css">


<!-- Comment -->

    
        <link href="https://cdn.bootcss.com/gitalk/1.5.0/gitalk.min.css" rel="stylesheet">
    

    


<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">


    <!-- 百度统计 -->
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e0f2380f55bc7efe3789f3e070e5d99a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



</head>
<body class="post-template">
<div id="page" class="site">

    <header class="site-header">
    <h1 class="site-title"><a href="https://zhangajian.com">张阿简博客</a></h1>
    <a class="sidebar-toggle"><span class="screen-reader-text">Menu</span><span class="icon" aria-hidden="true"></span></a>
</header>

<aside class="sidebar">
    <div class="sidebar-scrollable">
        <div class="inner">
            <div class="widget-area">
                <!-- 菜单 -->
                <nav class="site-navigation">
                    <h2>张阿简博客</h2>
                    <ul class="menu">
                        
                            <li class="menu-item home current-menu-item">
                                <a href="/"
                                
                                >首页</a>
                            </li>
                        
                            <li class="menu-item home current-menu-item">
                                <a href="/archives"
                                
                                >归档</a>
                            </li>
                        
                            <li class="menu-item home current-menu-item">
                                <a href="https://zhangajian.com/tags"
                                
                                >标签</a>
                            </li>
                        
                    </ul>
                </nav>

                <section class="widget widget-about">
                    <h2 class="widget-title">关于</h2>
                    <p>Kill Time, Or Kiss Time</p>
                </section>

                <section class="widget widget-tags">
                    <h2 class="widget-title">标签</h2>
                    <div class="tagcloud">
                        
                            <a href="https://zhangajian.com/tag/-6RH_hF5V" class="button">
                                Gridea
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/ISfc6GmDv1" class="button">
                                主题
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/wa6VE0See" class="button">
                                原创
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/FUUIh5fRu" class="button">
                                阅读
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/fb3yEkNaz" class="button">
                                Supervisor
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/laravel" class="button">
                                Laravel
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/TnE9j9p54" class="button">
                                生活
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/2Lrsz8nQ5" class="button">
                                Java
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/linux" class="button">
                                Linux
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/Q1TPBCeTZ" class="button">
                                Minecraft
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/screen" class="button">
                                screen
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/R9XMeHPGI" class="button">
                                Mac
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/7GuO-rABn" class="button">
                                Certbot
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/32-ELgkvl" class="button">
                                HTTPS
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/nginx" class="button">
                                Nginx
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/gWr_Ce0M-" class="button">
                                PHP
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/WU4oQ_US9" class="button">
                                WordPress
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/zpAo_gez-" class="button">
                                Mysql
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/XljxheWyB" class="button">
                                Composer
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/Zo5YAjmh-" class="button">
                                设计模式
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                            <a href="https://zhangajian.com/tag/f8yREx6Zn" class="button">
                                Redis
                                <span aria-hidden="true"><span class="line left"></span><span class="line top"></span><span class="line right"></span><span class="line bottom"></span></span>
                            </a>
                        
                    </div>
                </section>

            </div>
            <a class="sidebar-toggle"><span class="screen-reader-text">Close</span><span class="icon" aria-hidden="true"></span></a>
        </div>
    </div>
</aside>


    <main class="site-main">
        <div class="site-content">
            <article class="post tag-getting-started">
                <header class="cover post-header">
                    <div class="cover-bg" >

                        
                            <img srcset="https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c_43.jpg 300w, https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c_43.jpg 600w, https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c_43.jpg 800w, https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c_43.jpg 1600w, https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c_43.jpg 2000w"
                                 sizes="100vw" src="https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c_43.jpg" alt="理解「依赖注入」和「控制反转」"/>
                        

                    </div>
                    <div class="cover-content">
                        <div class="inner">
                            <div class="post-tags">
                                
                                    
                                        <a href="https://zhangajian.com/tag/Zo5YAjmh-">设计模式&nbsp;&nbsp;</a>
                                    
                                        <a href="https://zhangajian.com/tag/gWr_Ce0M-">PHP&nbsp;&nbsp;</a>
                                    
                                        <a href="https://zhangajian.com/tag/wa6VE0See">原创&nbsp;&nbsp;</a>
                                    
                                
                            </div>
                            <h1 class="post-title">理解「依赖注入」和「控制反转」</h1>
                            <div class="post-meta">
                                <span class="post-meta-wrap">
                                    <img class="author-avatar"
                                         srcset="https://zhangajian.com/media/images/avatar.png, https://zhangajian.com/media/images/avatar.png 2x"
                                         src="https://zhangajian.com/media/images/avatar.png" alt=""/>
                                    <span class="post-author">1421字</span>
                                    <time class="published" datetime="2017-06-05">2017-06-05</time>
                                </span>
                                <div>6 min read</div>
                            </div>
                            <a href="#post-content" class="arrow-down" data-scroll><span class="screen-reader-text">Scroll Down</span></a>
                        </div>
                    </div>
                </header>
                <div class="inner">

                    <div id="post-content" class="post-content">
                        <h1 id="一-依赖注入和控制反转是什么">一. 依赖注入和控制反转是什么？</h1>
<h4 id="名词解释">名词解释：</h4>
<h4 id="ioc">IoC</h4>
<blockquote>
<ul>
<li>控制反转 Inversion of Control</li>
<li>依赖关系的转移</li>
<li>依赖抽象而非实践</li>
</ul>
</blockquote>
<h4 id="di">DI</h4>
<blockquote>
<ul>
<li>依赖注入 Dependency Injection</li>
<li>不必自己在代码中维护对象的依赖</li>
<li>容器自动根据配置，将依赖注入指定对象</li>
</ul>
</blockquote>
<h4 id="container">Container</h4>
<blockquote>
<ul>
<li>管理对象的生成、资源取得、销毁等生命周期</li>
<li>建立对象与对象之间的依赖关系</li>
<li>启动容器后，所有对象直接取用，不用编写任何一行代码来产生对象，或是建立对象之间的依赖关系</li>
</ul>
</blockquote>
<p>------------以上引用自网络</p>
<h1 id="二-ioc代码演示">二. IoC代码演示</h1>
<p>高层应用程序需要调用底层模块接口,导致高层应用程序对低层模块产生依赖。</p>
<pre><code>&lt;?php
    // 高层类
    class Order
    {
        private $track;
        public function __construct()
        {
            $this-&gt;track = new sf();    //顺丰快递
        }

        public function query()
        {
            return $this-&gt;track-&gt;select();
        }
    }
    // 底层类，快递接口
    class sf
    {
        public function select
        {
            return &quot;快递已送达&quot;;
        }
    }
    $order = new Order();
    $order-&gt;query();
</code></pre>
<p>假设我们有一个订单类，需要跟踪订单的物流信息，物流目前是和顺丰快递进行合作。但后因种种原因，需要迁移快递物流平台到圆通上去,那现在因为产生了物流接口依赖，程序无法重用，并且必须要修改或者新增圆通快递接口。这就是由于低层模块变化导致高层也跟着变化，不好的设计。</p>
<h4 id="而正如上面的ioc解释">而正如上面的IoC解释</h4>
<blockquote>
<ul>
<li>控制反转 Inversion of Control</li>
<li>依赖关系的转移</li>
<li>依赖抽象而非实践</li>
</ul>
</blockquote>
<p>程序不应该依赖于具体的实现，而是要依赖抽象的接口。如下：</p>
<pre><code>&lt;?php
    // 物流平台接口
    interface trackBox
    {
        public function select();
    }

    // 高层类
    class Order
    {
        private $track;

        public function setTrack($track)
        {
            $this-&gt;track = $track;
        }

        public function query()
        {
            return $this-&gt;track-&gt;select();
        }
    }

    // 底层 顺丰
    class sf implements trackBox
    {
        public function select()
        {
            return &quot;顺丰快递已送达&quot;;
        }
    }

    // 底层 圆通
    class yt implements trackBox
    {
        public function select()
        {
            return &quot;圆通快递已送达&quot;;
        }
    }

    $order = new Order();
    $order-&gt;setTrack(new sf());
    $order-&gt;query(): //顺丰快递已送达

    $order-&gt;setTrack(new yt());
    $order-&gt;query(): //圆通快递已送达
</code></pre>
<p>这样就将原来的物流查询模块对程序的控制权转移到trackBox接口上，让order类和各种物流接口类都依赖于trackBox,这样就实现了控制反转。面对变化，高层不用修改一行代码，不再依赖低层，而是依赖注入，这也就引出了(依赖注入)DI。<br/><br>
依赖注入的方式有很多，但是主要思想就是如上所示，我们将一个依赖通过注入的方式进行使用。而不是直接将依赖写入被依赖中进行具体的实现。</p>
<h1 id="三-依赖注入容器-dependency-injection-container">三. 依赖注入容器 Dependency Injection Container</h1>
<p>那我们接下来继续思考，如果此后业务扩张，合作的物流平台越来越丰富，那么高层程序依赖的物流接口就会越来越多，我们就需要创建的依赖接口实例也会越来越多，这样就很不利于后期的维护</p>
<pre><code>    //底层物流接口
    class sf implements trackBox{ ... } //顺丰
    class yt implements trackBox{ ... } //圆通
    class zt implements trackBox{ ... } //中通
    class yd implements trackBox{ ... } //韵达
    class ems implements trackBox{ ... } //EMS

    //依赖注入
    $order = new Order();
    $order-&gt;setTrack(new sf());
    $order-&gt;select(): //顺丰快递已送达

    $order-&gt;setTrack(new yt());
    $order-&gt;select(): //圆通快递已送达

    $order-&gt;setTrack(new zt());
    $order-&gt;select(): //中通快递已送达

    $order-&gt;setTrack(new yd());
    $order-&gt;select(): //韵达快递已送达

    $order-&gt;setTrack(new ems());
    $order-&gt;select(): //EMS快递已送达
</code></pre>
<p>这个时候，我们有一种比较优雅的设计方案就是采用&quot;工厂模式&quot;，</p>
<blockquote>
<p>工厂模式，个人理解就是一个类所依赖的外部实例，可以被一个或多个&quot;工厂&quot;创建的这样一种开发模式</p>
</blockquote>
<p>我们不手动进行创建依赖实例，而是通过工厂去创建依赖实例，我们需要做的只是通过工厂拿到我们需要用到的依赖实例</p>
<pre><code class="language-php">&lt;?php
    // 工厂类
    class TrackFactory
    {
        public function makeTrack($trackName)
        {
            switch ($trackName) {
                case 'sf':     return new sf();
                case 'yt':     return new yt();
                case 'zt':     return new zt();
                case 'yd':     return new yd();
                case 'ems':     return new ems();
            }

            // return new $trackName();
        }
    }

    // 高层类
    class Order
    {
        private $track;

        public function __construct(array $tracks)
        {
            // 初始化工厂类
            $trackFactory = new TrackFactory();
            // 通过工厂类提供的方法制造所需要的物流平台
            foreach ($tracks as $trackName) {
                $this-&gt;$track[] = $trackFactory-&gt;makeTrack($trackName);
            }
        }

        public function query($trackName)
        {
            return $this-&gt;track[$trackName]-&gt;select();
        }
    }

    $Order = new Order(['sf','yd','ems','zt',]);
    $Order-&gt;query('sf');
    $Order-&gt;query('yd');
    $Order-&gt;query('ems');

</code></pre>
<p>尽管工厂模式让我们的代码变得优雅了一点，但是我们又回到了开头的错误中来，我们现在对工厂类进行了依赖,并且在物流接口愈加丰富后，工厂类也会慢慢变的冗长而不利于维护，那我们要怎么才能设计出一套即优雅又松耦合的应用程序呢？这个时候就需要有容器这个概念</p>
<h4 id="container-2">Container</h4>
<blockquote>
<ul>
<li>管理对象的生成、资源取得、销毁等生命周期</li>
<li>建立对象与对象之间的依赖关系</li>
<li>启动容器后，所有对象直接取用，不用编写任何一行代码来产生对象，或是建立对象之间的依赖关系</li>
</ul>
</blockquote>
<pre><code>&lt;?php
    // 容器类
    class Container
    {
        protected $binds;
        public function bind($service, $instance)
        {
            if ($concrete instanceof Closure) {
                $this-&gt;binds[$service] = $instance;
            }
        }

        public function make($service, $parameters)
        {
            return call_user_func_array([$this-&gt;binds[$service],], $parameters);
        }
    }

    // 高层类
    class Order
    {
        private $track;

        public function __construct($track)
        {
            $this-&gt;track = $track;
        }

        public function query()
        {
            return $this-&gt;track-&gt;select();
        }
    }

    $container = new Container();
    $container-&gt;bind('sf', function($container) {
        return new sf();
    });
    $container-&gt;bind('Order', function($container) {
        return new Order();
    });

    $Order = $container-&gt;make('Order','sf');

</code></pre>

                    </div>

                </div>
            </article>

            <section class="comments-area">
    <div class="inner">
        <h2 class="screen-reader-text">评论</h2>
        
            
                <div id="gitalk-container"></div>
            

            
        
    </div>
</section>


            
                <nav class="post-navigation">
                    <h2 class="screen-reader-text">Post navigation</h2>
                    <div class="nav-links">
                        <a href="https://zhangajian.com/post/mac-xia-an-zhuang-redis-he-php-redis-kuo-zhan" class="nav-previous">
                            <div class="nav-bg" >
                                
                                    <img srcset="https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c_44.jpg 300w, https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c_44.jpg 600w, https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c_44.jpg 800w, https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c_44.jpg 1600w, https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c_44.jpg 2000w" sizes="(max-width: 800px) 100vw, 50vw" src="https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c_44.jpg" alt="图裂了"/>
                                
                            </div>
                            <div class="nav-inside">
                                <span class="nav-before">下一篇</span>
                                <span class="nav-title">Mac下安装Redis和php-redis扩展</span>
                                <span class="nav-date">2017-03-10</span>
                            </div>
                        </a>
                    </div>
                </nav>
            

        </div>
    </main>

    <footer class="site-footer">
    <div class="inner">
        <!-- 社交 -->
        <div class="offsite-links">
            
                
            
                
            
                
            
                
            
                
            
        </div>

        <div class="site-info">
            THEME BY <a href="https://github.com/GalaxySuze/gridea-theme-subtle-galaxy">Subtle Galaxy</a>, REFERENCE FROM <a href="https://subtle.justgoodthemes.com/">Subtle</a><br/>
            Powered by <a target="_blank" href="https://gridea.dev/">Gridea</a>, © 2016 - 2019 Copyright 张阿简. All Rights Reserved.
        </div>
        <a href="#page" class="arrow-up" data-scroll><span class="screen-reader-text">Back to the top</span></a>
    </div>
</footer>


</div>

<script src="https://zhangajian.com/media/scripts/_core/plugins.js"></script>
<script src="https://zhangajian.com/media/scripts/_core/custom.js"></script>

<!-- highlight -->
<script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>
<!-- Md5 Min JS -->
<script src="https://zhangajian.com/media/scripts/_vendors/md5.min.js"></script>

<script type="application/javascript">
    // 代码高亮
    hljs.initHighlightingOnLoad();

</script>



    
        <script src="https://cdn.bootcss.com/gitalk/1.5.0/gitalk.min.js"></script>
        <script>

            var gitalk = new Gitalk({
                clientID: 'f82af725bc4967d0e195',
                clientSecret: 'ea48b3d1484e6658649b97c3de3dd33e0ca89a64',
                repo: 'ZhangAJianBlogGitalk',
                owner: 'GalaxySuze',
                admin: ['GalaxySuze'],
                id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                distractionFreeMode: false  // Facebook-like distraction free mode
            })

            gitalk.render('gitalk-container')

        </script>
    

    





</body>
</html>
