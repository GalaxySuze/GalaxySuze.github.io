<!DOCTYPE html>
<html>
  <head>
      
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>å¼ é˜¿ç®€åšå®¢</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="Kill Time, Or Kiss Time"/>
<meta name="keywords" content="Kill Time, Or Kiss Time"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://zhangajian.com/favicon.ico">

<link rel="stylesheet" href="https://zhangajian.com/styles/main.css">

<!-- Modernizr JS -->
<script src="https://zhangajian.com/media/scripts/_vendors/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://zhangajian.com/media/scripts/_vendors/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->

    
        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
    

    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/tomorrow-night.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<link crossorigin="anonymous" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" href="https://lib.baomitu.com/font-awesome/5.8.1/css/all.min.css" rel="stylesheet">

  </head>
  <body>
  
<div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://zhangajian.com/media/images/avatar.png" alt="å¼ é˜¿ç®€åšå®¢" class="img-responsive">
        </figure>
        <h3 class="heading">ABOUT ME</h3>
        <h2>å¼ é˜¿ç®€åšå®¢</h2>
        <p>Kill Time, Or Kiss Time</p>
        <ul class="fh5co-social">
            
                <li>
                    
                        <a href="https://github.com/GalaxySuze" target="_blank">
                            <i class="fab fa-github"></i>
                        </a>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                        <a href="https://www.weibo.com/helloworldvick" target="_blank">
                            <i class="fab fa-weibo"></i>
                        </a>
                    
                </li>
            
                <li>
                    
                        <a href="https://www.zhihu.com/people/su-suze/activities" target="_blank">
                            <i class="fab fa-zhihu"></i>
                        </a>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">
        <div class="fh5co-box">
            <h3 class="heading">æœç´¢</h3>
            <form action="#">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="è¾“å…¥å…³é”®å­—">
                </div>
            </form>
        </div>
        <div class="fh5co-box">
            <h3 class="heading">æ ‡ç­¾</h3>
            <ul>
                
                    <li><a href="https://zhangajian.com/tag/wa6VE0See">åŸåˆ›</a></li>
                
                    <li><a href="https://zhangajian.com/tag/TnE9j9p54">ç”Ÿæ´»</a></li>
                
                    <li><a href="https://zhangajian.com/tag/2Lrsz8nQ5">Java</a></li>
                
                    <li><a href="https://zhangajian.com/tag/linux">Linux</a></li>
                
                    <li><a href="https://zhangajian.com/tag/Q1TPBCeTZ">Minecraft</a></li>
                
                    <li><a href="https://zhangajian.com/tag/screen">screen</a></li>
                
                    <li><a href="https://zhangajian.com/tag/R9XMeHPGI">Mac</a></li>
                
                    <li><a href="https://zhangajian.com/tag/-v19lpUsp">Beyond Compare</a></li>
                
                    <li><a href="https://zhangajian.com/tag/7GuO-rABn">Certbot</a></li>
                
                    <li><a href="https://zhangajian.com/tag/32-ELgkvl">HTTPS</a></li>
                
                    <li><a href="https://zhangajian.com/tag/nginx">Nginx</a></li>
                
                    <li><a href="https://zhangajian.com/tag/gWr_Ce0M-">PHP</a></li>
                
                    <li><a href="https://zhangajian.com/tag/WU4oQ_US9">WordPress</a></li>
                
                    <li><a href="https://zhangajian.com/tag/zpAo_gez-">Mysql</a></li>
                
                    <li><a href="https://zhangajian.com/tag/laravel">Laravel</a></li>
                
                    <li><a href="https://zhangajian.com/tag/XljxheWyB">Composer</a></li>
                
                    <li><a href="https://zhangajian.com/tag/Zo5YAjmh-">è®¾è®¡æ¨¡å¼</a></li>
                
                    <li><a href="https://zhangajian.com/tag/f8yREx6Zn">Redis</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                         >
                            é¦–é¡µ
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                         >
                            å½’æ¡£
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                         >
                            æ ‡ç­¾
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                         >
                            å…³äº
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://zhangajian.com">å¼ é˜¿ç®€åšå®¢</a>
                </h1>
            </div>
        </div>
    </div>
</header>


<!--  <a href="#" class="fh5co-post-prev"><span>ğŸ‘ˆ Prev</span></a>-->
<!--  <a href="#" class="fh5co-post-next"><span>Next ğŸ‘‰</span></a>-->

  <div class="container-fluid">
      <div class="row fh5co-post-entry single-entry">
          <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
              <figure class="animate-box">
                  
                      <img src="https://blog-img-hosting.oss-cn-shanghai.aliyuncs.com/blog/article_cover/c-51.jpeg" alt="é€šè¿‡Certbotå®‰è£…Let&#39;s Encryptè¯ä¹¦å®ç°å…¨ç«™çš„HTTPSè®¿é—®" class="img-responsive">
                  
              </figure>
              <span class="fh5co-meta animate-box">
                  
                      <div class="tag-container">
                          
                              <a href="https://zhangajian.com/tag/7GuO-rABn" class="tag">Certbot, </a>
                          
                              <a href="https://zhangajian.com/tag/32-ELgkvl" class="tag">HTTPS, </a>
                          
                              <a href="https://zhangajian.com/tag/nginx" class="tag">Nginx, </a>
                          
                              <a href="https://zhangajian.com/tag/linux" class="tag">Linux, </a>
                          
                              <a href="https://zhangajian.com/tag/wa6VE0See" class="tag">åŸåˆ›, </a>
                          
                      </div>
                  
              </span>
              <h2 class="fh5co-article-title animate-box">é€šè¿‡Certbotå®‰è£…Let&#39;s Encryptè¯ä¹¦å®ç°å…¨ç«™çš„HTTPSè®¿é—®</h2>
              <span class="fh5co-meta fh5co-date animate-box">2018-11-17</span>

              <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                  <div class="row">
                      <div class="col-md-12 animate-box post-content">
                          <p> <h1 id="ç›¸å…³çŸ¥è¯†">ç›¸å…³çŸ¥è¯†</h1>
<h3 id="httphttps-æ˜¯ä»€ä¹ˆ">HTTP/HTTPS æ˜¯ä»€ä¹ˆ?</h3>
<blockquote>
<p>ç®€å•æ¥è¯´ï¼ŒHTTP æ˜¯ä¸€ä¸ªä¼ è¾“ç½‘é¡µå†…å®¹çš„åè®®ï¼Œæ¯”å¦‚æˆ‘ä»¬æµè§ˆä¸€ä¸ªç½‘é¡µï¼Œç½‘é¡µä¸Šçš„æ–‡å­—ã€å›¾ç‰‡ã€ CSS ã€ JS ç­‰æ–‡ä»¶éƒ½æ˜¯é€šè¿‡ HTTP åè®®ä¼ è¾“åˆ°æˆ‘ä»¬çš„æµè§ˆå™¨ï¼Œç„¶åè¢«æˆ‘ä»¬çœ‹åˆ°ã€‚å› ä¸º HTTP æ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œé€šè¿‡ HTTP åè®®ä¼ è¾“çš„å†…å®¹å¾ˆå®¹æ˜“è¢«å·çœ‹å’Œç¯¡æ”¹ï¼Œä¸ºäº†å®‰å…¨ï¼ˆä½ è‚¯å®šä¸æƒ³è¢«äººå·çœ‹æˆ–è€…ç¯¡æ”¹ç½‘é¡µå†…å®¹å§ï¼Œæ¯”å¦‚ç½‘ç«™é“¶è¡Œå¯†ç ä»€ä¹ˆçš„ã€‚ï¼‰å°±ä¸º HTTP åè®®å†åŠ ä¸Šäº†ä¸€å±‚ SSL/TLS å®‰å…¨åè®®ï¼Œæ‰€ä»¥å°±æœ‰äº† HTTPS ã€‚</p>
</blockquote>
<h3 id="ssltls-æ˜¯ä»€ä¹ˆ">SSL/TLS æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<blockquote>
<p>SSL æ˜¯æŒ‡å®‰å…¨å¥—æ¥å­—å±‚ï¼ˆSecure Sockets Layerï¼‰ï¼Œå†…å¿ƒçº¯æ´çš„åŒå­¦ä¹Ÿå¯ä»¥ç†è§£ä¸ºã€Œå¸¦å®‰å…¨å¥—çš„ HTTPã€ï¼Œå› ä¸ºå¸¦äº†å®‰å…¨å¥—ï¼Œæ‰€ä»¥å½“ç„¶ä¼šæ¯”è¾ƒå®‰å…¨ã€‚TLS æ˜¯ ä¼ è¾“å±‚å®‰å…¨åè®®ï¼ˆTransport Layer Securityï¼‰ï¼ŒSSL å’Œ TLS æ˜¯åŒä¸€ä¸ªä¸œè¥¿çš„ä¸åŒé˜¶æ®µï¼Œç†è§£ä¸ºåŒä¸€ä¸ªä¸œè¥¿ä¹Ÿè¡Œï¼Œéƒ½æ˜¯å®‰å…¨åè®®å°±å¯¹äº†ã€‚</p>
</blockquote>
<h3 id="ä¸ºä»€ä¹ˆè¦éƒ¨ç½²-https">ä¸ºä»€ä¹ˆè¦éƒ¨ç½² HTTPSï¼Ÿ</h3>
<blockquote>
<p>è¯´åˆ°åº•ï¼Œå°±æ˜¯ HTTPS æ›´å®‰å…¨ã€‚ç”šè‡³ä¸ºäº†å®‰å…¨ï¼Œä¸€ä¸ªä¸“ä¸šå¯é çš„ç½‘ç«™ï¼Œ HTTPS æ˜¯å¿…é¡»çš„ã€‚ Firefox å’Œ Chrome éƒ½è®¡åˆ’å°†æ²¡æœ‰é…ç½® SSL åŠ å¯†çš„ HTTP ç½‘ç«™æ ‡è®°ä¸ºä¸å®‰å…¨ï¼Œç›®å‰å®ƒä»¬ä¹Ÿæ­£åœ¨è”åˆå…¶ä»–ç›¸å…³çš„åŸºé‡‘ä¼šä¸å…¬å¸æ¨åŠ¨æ•´ä¸ªäº’è”ç½‘ HTTPS åŒ–ï¼Œç°åœ¨å¤§å®¶è®¿é—®çš„ä¸€äº›ä¸»è¦çš„ç½‘ç«™ã€‚å¦‚ Google å¤šå¹´å‰å°±å·²ç»å…¨éƒ¨å¯ç”¨ HTTPS ï¼Œå›½å†…çš„æ·˜å®ã€æœç‹—ã€çŸ¥ä¹ã€ç™¾åº¦ç­‰ç­‰ä¹Ÿå…¨é¢ HTTPS äº†ã€‚ç”šè‡³ Google å’Œç™¾åº¦çš„æœç´¢ç»“æœä¹Ÿæ­£åœ¨ç»™äºˆ HTTPS çš„ç½‘ç«™æ›´é«˜çš„æ’åå’Œä¼˜å…ˆæ”¶å½•æƒã€‚</p>
</blockquote>
<h3 id="æ€ä¹ˆéƒ¨ç½²-https-å‘¢">æ€ä¹ˆéƒ¨ç½² HTTPS å‘¢ï¼Ÿ</h3>
<blockquote>
<p>ä½ åªéœ€è¦æœ‰ä¸€å¼ è¢«ä¿¡ä»»çš„ CA ï¼ˆ Certificate Authority ï¼‰ä¹Ÿå°±æ˜¯è¯ä¹¦æˆæƒä¸­å¿ƒé¢å‘çš„ SSL å®‰å…¨è¯ä¹¦ï¼Œå¹¶ä¸”å°†å®ƒéƒ¨ç½²åˆ°ä½ çš„ç½‘ç«™æœåŠ¡å™¨ä¸Šã€‚ä¸€æ—¦éƒ¨ç½²æˆåŠŸåï¼Œå½“ç”¨æˆ·è®¿é—®ä½ çš„ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨ä¼šåœ¨æ˜¾ç¤ºçš„ç½‘å€å‰åŠ ä¸€æŠŠå°ç»¿é”ï¼Œè¡¨æ˜è¿™ä¸ªç½‘ç«™æ˜¯å®‰å…¨çš„ï¼Œå½“ç„¶åŒæ—¶ä½ ä¹Ÿä¼šçœ‹åˆ°ç½‘å€å‰çš„å‰ç¼€å˜æˆäº† HTTPS ï¼Œä¸å†æ˜¯ HTTP äº†ã€‚</p>
</blockquote>
<h3 id="æ€ä¹ˆè·å¾—-ssl-å®‰å…¨è¯ä¹¦å‘¢">æ€ä¹ˆè·å¾— SSL å®‰å…¨è¯ä¹¦å‘¢ï¼Ÿ</h3>
<blockquote>
<p>ç†è®ºä¸Šï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥ç­¾å‘ SSL å®‰å…¨è¯ä¹¦ï¼Œä½†æ˜¯æˆ‘ä»¬è‡ªå·±ç­¾å‘çš„å®‰å…¨è¯ä¹¦ä¸ä¼šè¢«ä¸»æµçš„æµè§ˆå™¨ä¿¡ä»»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¢«ä¿¡ä»»çš„è¯ä¹¦æˆæƒä¸­å¿ƒï¼ˆ CA ï¼‰ç­¾å‘çš„å®‰å…¨è¯ä¹¦ã€‚è€Œä¸€èˆ¬çš„ SSL å®‰å…¨è¯ä¹¦ç­¾å‘æœåŠ¡éƒ½æ¯”è¾ƒè´µï¼Œæ¯”å¦‚ Godaddy ã€ GlobalSign ç­‰æœºæ„ç­¾å‘çš„è¯ä¹¦ä¸€èˆ¬éƒ½éœ€è¦20ç¾é‡‘ä¸€å¹´ç”šè‡³æ›´è´µï¼Œä¸è¿‡ä¸ºäº†åŠ å¿«æ¨å¹¿ HTTPS çš„æ™®åŠï¼Œ EEF ç”µå­å‰å“¨åŸºé‡‘ä¼šã€ Mozilla åŸºé‡‘ä¼šå’Œç¾å›½å¯†æ­‡æ ¹å¤§å­¦æˆç«‹äº†ä¸€ä¸ªå…¬ç›Šç»„ç»‡å« ISRG ï¼ˆ Internet Security Research Group ï¼‰ï¼Œè¿™ä¸ªç»„ç»‡ä» 2015 å¹´å¼€å§‹æ¨å‡ºäº† Letâ€™s Encrypt å…è´¹è¯ä¹¦ã€‚è¿™ä¸ªå…è´¹è¯ä¹¦ä¸ä»…å…è´¹ï¼Œè€Œä¸”è¿˜ç›¸å½“å¥½ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ Letâ€™s Encrypt æä¾›çš„å…è´¹è¯ä¹¦éƒ¨ç½² HTTPS äº†ã€‚</p>
</blockquote>
<h3 id="lets-encrypt-ç®€ä»‹">Letâ€™s Encrypt ç®€ä»‹</h3>
<blockquote>
<p>å‰é¢å·²ç»ä»‹ç»è¿‡ï¼Œ Letâ€™s Encrypt æ˜¯ ä¸€ä¸ªå« ISRG ï¼ˆ Internet Security Research Group ï¼Œäº’è”ç½‘å®‰å…¨ç ”ç©¶å°ç»„ï¼‰çš„ç»„ç»‡æ¨å‡ºçš„å…è´¹å®‰å…¨è¯ä¹¦è®¡åˆ’ã€‚å‚ä¸è¿™ä¸ªè®¡åˆ’çš„ç»„ç»‡å’Œå…¬å¸å¯ä»¥è¯´æ˜¯äº’è”ç½‘é¡¶é¡¶é‡è¦çš„å…ˆé©±ï¼Œé™¤äº†å‰æ–‡æåˆ°çš„ä¸‰ä¸ªç‰›æ°”å“„å“„çš„å‘èµ·å•ä½å¤–ï¼Œåæ¥åˆæœ‰æ€ç§‘ï¼ˆå…¨çƒç½‘ç»œè®¾å¤‡åˆ¶é€ å•†æ‰§ç‰›è€³è€…ï¼‰ã€ Akamai åŠ å…¥ï¼Œç”šè‡³è¿ Linux åŸºé‡‘ä¼šä¹ŸåŠ å…¥äº†åˆä½œï¼Œè¿™äº›å¤§ç‰Œç»„ç»‡çš„åŠ å…¥ä¿è¯äº†è¿™ä¸ªé¡¹ç›®çš„å¯ä¿¡åº¦å’Œå¯æŒç»­æ€§ã€‚</p>
</blockquote>
<h3 id="certbot-ç®€ä»‹">Certbot ç®€ä»‹</h3>
<blockquote>
<p>ISRG çš„å‘èµ·è€… EFF ï¼ˆç”µå­å‰å“¨åŸºé‡‘ä¼šï¼‰ä¸º Letâ€™s Encrypt é¡¹ç›®å‘å¸ƒäº†ä¸€ä¸ªå®˜æ–¹çš„å®¢æˆ·ç«¯ Certbot ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å®Œå…¨è‡ªåŠ¨åŒ–çš„è·å–ã€éƒ¨ç½²å’Œæ›´æ–°å®‰å…¨è¯ä¹¦ã€‚è™½ç„¶ç¬¬ä¸‰æ–¹å·¥å…·ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å®˜æ–¹å·¥å…·æ›´æƒå¨ï¼Œé£é™©ä¹Ÿæ›´å°ï¼Œè€Œä¸”é‡åˆ°é—®é¢˜ä¹Ÿæ›´å®¹æ˜“è§£å†³ï¼Œæ¯•ç«Ÿæœ‰å®˜æ–¹çš„æ”¯æŒã€‚</p>
</blockquote>
<h1 id="å®é™…æ“ä½œ">å®é™…æ“ä½œ</h1>
<h3 id="certbot-ä½¿ç”¨æ–¹æ³•">Certbot ä½¿ç”¨æ–¹æ³•</h3>
<p>Certbot çš„å®˜ç½‘æ˜¯<a href="https://certbot.eff.org/">https://certbot.eff.org/</a>, æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªé“¾æ¥ï¼Œé€‰æ‹©è‡ªå·±ä½¿ç”¨çš„ web server å’Œæ“ä½œç³»ç»Ÿã€‚é€‰æ‹©å®Œä¹‹åï¼Œå®˜ç½‘å°±ä¼šæ˜¾ç¤ºå‡ºå¯¹åº”çš„å®‰è£…æ“ä½œæ­¥éª¤ã€‚
ä»¥ç›®å‰æˆ‘æ‰€ä½¿ç”¨çš„æœåŠ¡å™¨ä¸ºä¾‹ï¼Œweb server ä½¿ç”¨Nginx(1.12)ï¼Œæ“ä½œç³»ç»Ÿæ˜¯CentOS(7.3)ã€‚å› ä¸º Certbot æ‰“åŒ…åœ¨EPELä¸­ï¼Œæ‰€ä»¥åœ¨å®‰è£… Certbot ä¹‹å‰è¦å…ˆå®‰è£…EPEL</p>
<pre><code class="language-shell">yum -y install epel-release
</code></pre>
<p>ç„¶åæŒ‰ç€å®˜ç½‘ç»™å‡ºçš„æ­¥éª¤æç¤ºå‘½ä»¤å®‰è£… Certbot</p>
<pre><code class="language-shell">yum install python2-certbot-nginx
</code></pre>
<p>å®‰è£…å®Œæ¯•åï¼Œç»§ç»­è¾“å…¥å®˜ç½‘æç¤ºå‘½ä»¤</p>
<pre><code class="language-shell">certbot --nginx
</code></pre>
<p>è¿è¡Œæ­¤å‘½ä»¤ä¼šè‡ªåŠ¨è·å–è¯ä¹¦ï¼Œå¹¶ä¸” Certbot ä¼šè‡ªåŠ¨ç¼–è¾‘Nginxé…ç½®æ–‡ä»¶é…ç½®HTTPSæœåŠ¡ã€‚</p>
<blockquote>
<p>è¿™è¾¹åœ¨è¿è¡Œé…ç½®å‘½ä»¤æ—¶é‡åˆ°ä¸€ä¸ªå‘</p>
</blockquote>
<pre><code class="language-shell">ImportError: No module named 'requests.packages.urllib3'
</code></pre>
<p>å¯ä»¥çœ‹å‡ºæ˜¯ç¼ºå°‘ä¸€ä¸ªæ¨¡å—åŒ…ï¼Œçœ‹é…ç½®å‘½ä»¤åœ¨å‘½ä»¤å°çš„è¾“å‡ºï¼ŒCertbot æ˜¯ç”¨ python æ¥å†™ Nginx é…ç½®ã€‚æ—¢ç„¶æ˜¯ç”¨çš„ pythonï¼Œå¯ä»¥é€šè¿‡ <strong>pip list</strong> å‘½ä»¤æŸ¥çœ‹ python çš„ä¾èµ–åŒ…åˆ—è¡¨ã€‚ä½†æ˜¯æŸ¥çœ‹æ˜¯å·²ç»å­˜åœ¨çš„ï¼Œè¿™ä¸ªé—®é¢˜å¾ˆå¿«é€šè¿‡ Certbot åœ¨ github ä¸Šçš„ä¸€ä¸ª Issues æ‰¾åˆ°äº†ç­”æ¡ˆï¼ˆ<a href="https://github.com/certbot/certbot/issues/5104">Issuesé“¾æ¥</a>ï¼‰ã€‚ç›®å‰çœ‹æ˜¯åŒ…çš„ç‰ˆæœ¬ä¾èµ–æœ‰é—®é¢˜ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œä¾èµ–åŒ…çš„é‡è£…</p>
<pre><code class="language-shell">pip uninstall requests
pip uninstall urllib3
yum remove python-urllib3
yum remove python-requests
yum install python-urllib3
yum install python-requests
yum install certbot
</code></pre>
<p>å†æ¬¡æ‰§è¡Œ <strong>certbot --nginx</strong> å‘½ä»¤æˆåŠŸã€‚å‘½ä»¤æ‰§è¡Œåé¦–å…ˆä¼šæç¤ºè¾“å…¥ä¸€ä¸ªé‚®ç®±åœ°å€ï¼Œä¸»è¦ä½œç”¨æ˜¯è®¢é˜…ä¸€äº›é€šçŸ¥ï¼Œè¾“å…¥åå›è½¦ã€‚</p>
<pre><code class="language-shell">[root@izuf6fco0zwyipdq9485s2z ~]# certbot --nginx
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator nginx, Installer nginx

â–½
Enter email address (used for urgent renewal and security notices) (Enter 'c' to
cancel): demo@mail.com // æ¼”ç¤ºé‚®ç®±
Starting new HTTPS connection (1): acme-v02.api.letsencrypt.org

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</code></pre>
<p>å›è½¦å Certbot å°±ä¼šè‡ªåŠ¨è¯·æ±‚ä¸‹è½½ Let's Encrypt è¯ä¹¦ï¼Œå¹¶è®¾ç½® Nginx é…ç½®æ–‡ä»¶ã€‚æœŸé—´ä¼šæœ‰ä¸€äº›åŒæ„ç›¸å…³åè®®å’Œé€‰æ‹©å“ªä¸ªç½‘ç«™é…ç½®çš„äº¤äº’ï¼Œè¿™ä¸ªçœ‹è¾“å‡ºæ–‡å­—å°±èƒ½æ˜ç™½æ„æ€ã€‚</p>
<pre><code class="language-shell">...
â–½
server {
(A)gree/(C)ancel: a

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Would you be willing to share your email address with the Electronic Frontier
Foundation, a founding partner of the Let's Encrypt project and the non-profit
organization that develops Certbot? We'd like to send you email about our work
encrypting the web, EFF news, campaigns, and ways to support digital freedom.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(Y)es/(N)o: y
Starting new HTTPS connection (1): supporters.eff.org

Which names would you like to activate HTTPS for?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1: kisstime.top
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate numbers separated by commas and/or spaces, or leave input
blank to select all options shown (Enter 'c' to cancel): 1
Obtaining a new certificate
Performing the following challenges:
http-01 challenge for kisstime.top
Cleaning up challenges
...
</code></pre>
<blockquote>
<p>ä½†æ˜¯è¿™è¾¹åˆ° Certbot è®¾ç½® Nginx é…ç½®æ–‡ä»¶çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªå‘ï¼ŒæŠ¥å¦‚ä¸‹ä¸€ä¸ªé”™è¯¯</p>
</blockquote>
<pre><code class="language-shell">An unexpected error occurred:
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe5 in position 2: ordinal not in range(128)
Please see the logfiles in /var/log/letsencrypt for more details.
</code></pre>
<p>ç†Ÿæ‚‰ python çš„åŒå­¦åº”è¯¥å¯¹è¿™ä¸ªé”™è¯¯æ¯”è¾ƒäº†è§£ã€‚ä¸è¿‡åšä¸» python è¿˜æ˜¯ç”¨çš„æ¯”è¾ƒå°‘ï¼ŒèŠ±äº†ç‚¹æ—¶é—´äº†è§£äº†ä¸€ä¸‹ã€‚</p>
<blockquote>
<p>åœ¨è§£å†³é”™è¯¯ä¹‹å‰ï¼Œé¦–å…ˆè¦äº†è§£unicodeå’Œutf-8çš„åŒºåˆ«ã€‚unicodeæŒ‡çš„æ˜¯ä¸‡å›½ç ï¼Œæ˜¯ä¸€ç§â€œå­—ç è¡¨â€ã€‚è€Œutf-8æ˜¯è¿™ç§å­—ç è¡¨å‚¨å­˜çš„ç¼–ç æ–¹æ³•ã€‚unicodeä¸ä¸€å®šè¦ç”±utf-8è¿™ç§æ–¹å¼ç¼–æˆbytecodeå‚¨å­˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨utf-16,utf-7ç­‰å…¶ä»–æ–¹å¼ã€‚ç›®å‰å¤§å¤šéƒ½ä»¥utf-8çš„æ–¹å¼æ¥å˜æˆbytecodeã€‚å…¶æ¬¡ï¼ŒPythonä¸­å­—ç¬¦ä¸²ç±»å‹åˆ†ä¸ºbyte string å’Œ unicode stringä¸¤ç§ã€‚å¦‚æœåœ¨pythonæ–‡ä»¶ä¸­æŒ‡å®šç¼–ç æ–¹å¼ä¸ºutf-8(#coding=utf-8)ï¼Œé‚£ä¹ˆæ‰€æœ‰å¸¦ä¸­æ–‡çš„å­—ç¬¦ä¸²éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯utf-8ç¼–ç çš„byte stringï¼ˆä¾‹å¦‚ï¼šmystr=&quot;ä½ å¥½&quot;ï¼‰ï¼Œä½†æ˜¯åœ¨å‡½æ•°ä¸­æ‰€äº§ç”Ÿçš„å­—ç¬¦ä¸²åˆ™è¢«è®¤ä¸ºæ˜¯unicode stringã€‚é—®é¢˜å°±å‡ºåœ¨è¿™è¾¹ï¼Œunicode string å’Œ byte string æ˜¯ä¸å¯ä»¥æ··åˆä½¿ç”¨çš„ï¼Œä¸€æ—¦æ··åˆä½¿ç”¨äº†ï¼Œå°±ä¼šäº§ç”Ÿè¿™æ ·çš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼š</p>
</blockquote>
<pre><code class="language-python">self.response.out.write(&quot;ä½ å¥½&quot;+self.request.get(&quot;argu&quot;))
</code></pre>
<blockquote>
<p>å…¶ä¸­ï¼Œ&quot;ä½ å¥½&quot;è¢«è®¤ä¸ºæ˜¯byte stringï¼Œè€Œself.request.get(&quot;argu&quot;)çš„è¿”å›å€¼è¢«è®¤ä¸ºæ˜¯unicode stringã€‚ç”±äºé¢„è®¾çš„è§£ç å™¨æ˜¯asciiï¼Œæ‰€ä»¥å°±ä¸èƒ½è¯†åˆ«ä¸­æ–‡byte stringã€‚ç„¶åå°±æŠ¥é”™äº†ã€‚</p>
</blockquote>
<p>é‚£ç†è§£äº†è¿™ä¸ªé”™è¯¯åŸå› åï¼Œæˆ‘è¿™è¾¹é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯ç½‘ç«™çš„ Nginx é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å«æœ‰ä¸­æ–‡ã€‚æ‰“å¼€ä¸€çœ‹ï¼Œç¡®å®å­˜åœ¨ä¸­æ–‡æ³¨é‡Šã€‚å°†æ³¨é‡Šå»æ‰ï¼Œé‡æ–°æ‰§è¡Œå‘½ä»¤æˆåŠŸä¸åœ¨æŠ¥é”™</p>
<p>æ¥ç€å‘½ä»¤äº¤äº’ä¼šæç¤ºæ˜¯å¦å°†æ‰€æœ‰HTTPé‡å®šå‘åˆ°HTTPSï¼Œæˆ‘è¿™è¾¹é€‰æ‹©å…¨éƒ¨é‡å®šå‘ä¹Ÿå°±æ˜¯ã€Œ2ã€ã€‚</p>
<pre><code class="language-shell">Cleaning up challenges
Deploying Certificate to VirtualHost:  //è¿™è¾¹ä¼šæ˜¾ç¤ºä½ çš„ç½‘ç«™é…ç½®æ–‡ä»¶ç›®å½•

Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1: No redirect - Make no further changes to the webserver configuration.
2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for
new sites, or if you're confident your site works on HTTPS. You can undo this
change by editing your web server's configuration.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 2
Redirecting all traffic on port 80 to ssl in //è¿™è¾¹ä¼šæ˜¾ç¤ºä½ çš„ç½‘ç«™é…ç½®æ–‡ä»¶ç›®å½•

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Congratulations! You have successfully enabled https://kisstime.top

You should test your configuration at:
https://www.ssllabs.com/ssltest/analyze.html?d=kisstime.top
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
   .../fullchain.pem
   Your key file has been saved at:
   .../privkey.pem
   Your cert will expire on 2019-02-14. To obtain a new or tweaked
   version of this certificate in the future, simply run certbot again
   with the &quot;certonly&quot; option. To non-interactively renew *all* of
   your certificates, run &quot;certbot renew&quot;
 - If you like Certbot, please consider supporting our work by:

   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le
</code></pre>
<p>OKï¼Œå½“å®Œæˆä¸Šé¢æœ€åä¸€æ­¥åï¼Œè¾“å…¥å¦‚ä¸Šä¿¡æ¯åå°±è¡¨æ˜ HTTPS é…ç½®æˆåŠŸäº†ï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡æç¤ºä¸­çš„ <a href="www.ssllabs.com">SSL Server Test</a> ç½‘å€æ¥æµ‹è¯•ç½‘ç«™æ˜¯å¦èƒ½å¤Ÿ HTTPS æ¥è¿›è¡Œè®¿é—®</p>
<pre><code class="language-shell">You should test your configuration at:
https://www.ssllabs.com/ssltest/analyze.html?d=kisstime.top
</code></pre>
<p>äº‹å®è¯æ˜ï¼Œé«˜å…´çš„å¤ªæ—©äº†ã€‚ã€‚ã€‚é€šè¿‡æµ‹è¯•ç½‘ç«™å’Œç›´æ¥è®¿é—®åŸŸåå‘ç°ç½‘ç«™éƒ½æ˜¯è®¿é—®ä¸äº†ã€‚æ€è€ƒäº†ä¸€ä¸‹ï¼Œç¡®è®¤ä¸‹æœåŠ¡å™¨çš„443ç«¯å£æ˜¯å¦å¼€å¯ï¼Œæˆ‘è¿™è¾¹ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„æœåŠ¡å™¨ï¼Œç™»å½•æ§åˆ¶å°æŸ¥çœ‹å®‰å…¨ç»„è§„åˆ™ï¼Œå‘ç°ç¡®å®æ˜¯443ç«¯å£æ²¡æœ‰å¼€å¯ï¼Œé…ç½®å¼€å¯åï¼Œé‡æ–°è®¿é—®æˆåŠŸã€‚</p>
<h1 id="å…¶ä»–">å…¶ä»–</h1>
<h3 id="nginxçš„è®¾ç½®è¯´æ˜">Nginxçš„è®¾ç½®è¯´æ˜</h3>
<p>åŸºæœ¬ä¸Š Certbot ä¼šåœ¨å¯¹åº”çš„ Nginx é…ç½®æ–‡ä»¶åŠ ä¸Šä¸‹é¢çš„å‚æ•°ï¼š</p>
<pre><code class="language-nginx">server {
    # ... other configs
    
    # SSL è®¾ç½®
    listen 443 ssl;

    # set crt and key
    ssl_certificate .../fullchain.pem;
    ssl_certificate_key .../privkey.pem;
    
    # include åŸºæœ¬çš„ ssl è®¾ç½®
    include .../options-ssl-nginx.conf;
    
    # Certbot ä¹Ÿä¼šç”Ÿæˆä¸€æŠŠ Diffie-Hellman å¯†é’¥
    ssl_dhparam .../ssl-dhparams.pem;

    # ... other configs
}
</code></pre>
<h3 id="è‡ªåŠ¨æ›´æ–°è¯ä¹¦">è‡ªåŠ¨æ›´æ–°è¯ä¹¦</h3>
<p>Letâ€™s Encrypt å…è´¹SSLè¯ä¹¦ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œä½†æ¯æ¬¡ç”³è¯·åªæœ‰ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œåœ¨æ¯æ¬¡åˆ°æœŸä¹‹å‰éƒ½éœ€è¦é‡æ–°ç”³è¯·ï¼ŒCertbot å·²ç»æä¾›äº†ä¸€é”®ç»­è®¢çš„å‘½ä»¤</p>
<pre><code class="language-shell">certbot renew
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ æ­¤æ¡å‘½ä»¤çš„cronä½œä¸šï¼ˆæˆ–systemdè®¡æ—¶å™¨ï¼‰æ¥å®‰æ’è¯ä¹¦çš„è‡ªåŠ¨ç»­è®¢</p>
<pre><code class="language-shell">SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin

0 0,12 * * * certbot renew --quiet 
</code></pre>
<h3 id="certbot-çš„-log-è·¯å¾„">Certbot çš„ log è·¯å¾„</h3>
<p>Certbot çš„ log é¢„è®¾è·¯å¾„åœ¨ <strong>/var/log/letsencrypt</strong>ï¼Œæœ‰éœ€è¦å¯ä»¥å»ç¡®è®¤æŸ¥çœ‹ã€‚</p>
<h3 id="ç›¸å…³ç¬¬ä¸‰æ–¹">ç›¸å…³ç¬¬ä¸‰æ–¹</h3>
<p><a href="https://github.com/certbot/certbot/blob/master/certbot-auto">certbot-auto</a>æ˜¯å¯¹è„šæœ¬certbotçš„å°è£…ï¼Œå¯ä»¥è®¾ç½®ç³»ç»Ÿç¯å¢ƒæˆ–è‡ªåŠ¨å‡çº§ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h1>
<p>ç‰›é¡¿æ›¾ç»è¯´è¿‡ï¼šå¦‚æœè¯´æˆ‘çœ‹å¾—æ¯”åˆ«äººæ›´è¿œäº›ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šã€‚ï¼ˆIf I have seen further, it is by standing on the shoulders of giants.ï¼‰æ„Ÿè°¢ã€‚</p>
<ul>
<li><a href="https://certbot.eff.org/">https://certbot.eff.org/</a></li>
<li><a href="https://linuxstory.org/deploy-lets-encrypt-ssl-certificate-with-certbot">https://linuxstory.org/deploy-lets-encrypt-ssl-certificate-with-certbot</a></li>
<li><a href="https://blog.csdn.net/use_my_heart/article/details/51303317">https://blog.csdn.net/use_my_heart/article/details/51303317</a></li>
<li><a href="https://blog.hellojcc.tw/2018/05/02/setup-https-with-letsencrypt-on-nginx/">https://blog.hellojcc.tw/2018/05/02/setup-https-with-letsencrypt-on-nginx/</a></li>
</ul>
<h1 id="åšå®¢åŸæ–‡é“¾æ¥">åšå®¢åŸæ–‡é“¾æ¥</h1>
<p><a href="https://kisstime.top/?p=123">:point_right:ç‚¹å‡»é“¾æ¥</a></p>
 </p>
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              <div class="next-post">
                                  <div class="next">ä¸‹ä¸€ç¯‡</div>
                                  <a href="https://zhangajian.com/post/mac-xia-iterm2-ssh-mian-mi-deng-lu-a-li-yun">
                                      <h3 class="post-title">
                                          Macä¸‹iTerm2 SSH å…å¯†ç™»é™†é˜¿é‡Œäº‘
                                      </h3>
                                  </a>
                              </div>
                          
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              
                                  <div id="gitalk-container"></div>
                              

                              
                          
                      </div>
                  </div>
              </div>

          </article>
      </div>
  </div>

    
<footer id="fh5co-footer">
  <p>Powered by <a target="_blank" href="https://gridea.dev/">Gridea</a>, Â© 2016 - 2019 Copyright å¼ é˜¿ç®€. All Rights Reserved.</p>
</footer>


    
<!-- jQuery -->
<script src="https://zhangajian.com/media/scripts/_vendors/jquery.min.js"></script>
<!-- jQuery Easing -->
<script src="https://zhangajian.com/media/scripts/_vendors/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://zhangajian.com/media/scripts/_vendors/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://zhangajian.com/media/scripts/_vendors/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://zhangajian.com/media/scripts/_vendors/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://zhangajian.com/media/scripts/_vendors/md5.min.js"></script>

<script type="application/javascript">
    hljs.initHighlightingOnLoad();
</script>



    
        <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
        <script>

            var gitalk = new Gitalk({
                clientID: 'f82af725bc4967d0e195',
                clientSecret: 'ea48b3d1484e6658649b97c3de3dd33e0ca89a64',
                repo: 'ZhangAJianBlogGitalk',
                owner: 'GalaxySuze',
                admin: ['GalaxySuze'],
                id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                distractionFreeMode: false  // Facebook-like distraction free mode
            })

            gitalk.render('gitalk-container')

        </script>
    

    




  </body>
</html>
