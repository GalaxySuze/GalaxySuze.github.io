<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>在阿里云上部署WordPress | 张阿简的博客</title>
<link rel="shortcut icon" href="VickStar.coding.me/favicon.ico">
<link rel="stylesheet" href="VickStar.coding.me/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="VickStar.coding.me">
  <img class="avatar" src="VickStar.coding.me/images/avatar.png" alt="" width="80px" height="80px">
  </a>
  <h1 class="site-title">
    张阿简的博客
  </h1>
  <p class="site-description">
    Kill Time, Or Kiss Time
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
</div>

      
        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              在阿里云上部署WordPress
            </h2>
            <div class="post-info">
              <time class="post-time">
                · 2018-10-18 ·
              </time>
              
                <a href="VickStar.coding.me/tag/gWr_Ce0M-" class="post-tags">
                  # PHP
                </a>
              
                <a href="VickStar.coding.me/tag/WU4oQ_US9" class="post-tags">
                  # WordPress
                </a>
              
                <a href="VickStar.coding.me/tag/nginx" class="post-tags">
                  # Nginx
                </a>
              
                <a href="VickStar.coding.me/tag/linux" class="post-tags">
                  # Linux
                </a>
              
                <a href="VickStar.coding.me/tag/wa6VE0See" class="post-tags">
                  # 原创
                </a>
              
            </div>
            <div class="post-content">
              <p>最近刚好因为活动买了一台新的服务器，空着也空着，刚好可以用来搭博客使用，搭建博客这件事。之前也做过很多次，不管是用静态博客生成器，还是手写一个博客项目。都尝试过，思来想去，这次打算用用WordPress，听闻许久，也该用用看了。</p>
<h1 id="安装nginx">安装Nginx</h1><pre><code class="language-shell">yum -y install nginx</code></pre>
<h1 id="安装mysql5.7">安装Mysql5.7</h1><ul>
<li><p>安装 mysql 官方 yum 源</p>
<pre><code class="language-shell">rpm -ivh https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm</code></pre>
</li>
<li><p>查看 MySQL yum 源</p>
<pre><code class="language-shell">yum list | grep mysql</code></pre>
<p>发现只有 mysql80 的包，这是因为没有开启 mysql57 的包，关闭80包，开启57包。</p>
</li>
</ul>
<pre><code class="language-shell">yum-config-manager --disable mysql80-community
yum-config-manager --enable mysql57-community</code></pre>
<p>报错</p>
<pre><code class="language-shell">-bash: yum-config-manager: 未找到命令</code></pre>
<p>这个是因为系统默认没有安装这个命令，这个命令在yum-utils 包里，可以通过命令yum -y install yum-utils 安装就可以了。</p>
<ul>
<li><p>安装 yum-utils 包</p>
<pre><code class="language-shell">yum -y install yum-utils</code></pre>
</li>
<li><p>再次查看Mysql包列表出现57安装包</p>
</li>
<li><p>安装 Mysql57</p>
<pre><code class="language-shell">yum -y install mysql-community-server</code></pre>
</li>
<li><p>启动 Mysql57服务</p>
<pre><code class="language-shell">systemctl start mysqld</code></pre>
</li>
<li><p>查看初始密码</p>
<pre><code class="language-shell">grep &#39;temporary password&#39; /var/log/mysqld.log</code></pre>
</li>
<li><p>登录 Mysql，修改密码</p>
</li>
</ul>
<pre><code class="language-shell">mysql -uroot -p

set password for root@localhost = password(&#39;你的密码&#39;);</code></pre>
<p>如果提示错误，那是因为 mysql57 对密码的复杂度进行了限制，依次执行下列命令，取消复杂度限制，再修改</p>
<pre><code class="language-shell">set global validate_password_policy=0;
set global validate_password_mixed_case_count=0;
set global validate_password_number_count=3;
set global validate_password_special_char_count=0;
set global validate_password_length=3;</code></pre>
<p>提示错误</p>
<pre><code class="language-shell">[root@izuf6fco0zwyipdq9485s2z ~]# mysql -uroot -p
Enter password:
ERROR 1045 (28000): Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: YES)</code></pre>
<ul>
<li>如下操作修复<pre><code class="language-shell"># 先关闭服务
systemctl stop mysqld
# 跳过权限验证
mysqld --user=root --skip-grant-tables &amp;
# 登录
mysql -u root mysql
# 设置密码
UPDATE user SET authentication_string=PASSWORD(&#39;new password&#39;) where USER=&#39;root&#39;;
# 刷新设置
FLUSH PRIVILEGES;</code></pre>
</li>
</ul>
<h1 id="安装 php7.2">安装 PHP7.2</h1><p>php7.2 版本的 yum 源在 webtatic 上，但还有一部分需要依赖 epel-release 。EPEL(Extra Packages for Enterprise Linux )，是基于Fedora的一个项目，为“红帽系”的操作系统提供额外的软件包，适用于RHEL、CentOS和Scientific Linux。</p>
<ul>
<li>安装 epel-release</li>
</ul>
<pre><code class="language-shell">yum -y install epel-release</code></pre>
<p>安装完成后，在 /etc/yum.repos.d 目录下，就会多一个 epel.repo 的文件，还有一个 testing 的测试文件。当系统通过 yum 进行安装软件时，如果需要 epel 里的扩展包，就会自动下载安装。</p>
<ul>
<li>安装 webtatic yum 源</li>
</ul>
<pre><code class="language-shell">rpm -ivh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</code></pre>
<p>安装完成后，在 /etc/yum.repos.d 目录下会多出 webtatic.repo 和 webtatic-archive.repo 两个文件，还有一个 testing 的测试文件。</p>
<ul>
<li>查看 php 可以安装的包</li>
</ul>
<pre><code class="language-shell"> yum list | grep php72</code></pre>
<p>上面这些 rpm 包就是 webtatic 的 yum 源里面的包啦。我们要安装的就是 php72 的核心包 mod_php72w 和核心扩展包 php72w-cli 、php72w-fpm、php72w-common、php72w-devel。其它扩展选项包请根据需要安装，例如需要 php72w-gd 后期可单独安装。</p>
<ul>
<li>安装php72</li>
</ul>
<pre><code class="language-shell">yum -y install mod_php72w php72w-cli php72w-fpm php72w-common php72w-devel</code></pre>
<p>通过这种方式安装的 php72 的 php.ini 文件与我们认识的不太一样，它类似于 nginx.conf 存在一个主配置，通过类型 include 方法，包含指定文件夹下的模块配置文件。</p>
<ul>
<li>启动php-fpm</li>
</ul>
<pre><code class="language-shell">systemctl start php-fpm</code></pre>
<h1 id="安装 wordpress">安装 WordPress</h1><ul>
<li><p>下载wordpress</p>
<pre><code class="language-shell">wget https://cn.wordpress.org/wordpress-4.9.4-zh_CN.tar.gz</code></pre>
</li>
<li><p>解压到/home/目录下</p>
<pre><code class="language-shell">tar -zxvf wordpress-4.9.4-zh_CN.tar.gz -C /home/</code></pre>
</li>
<li><p>登陆mysql并添加数据库，命名为wordpress</p>
<pre><code class="language-shell">mysql -uroot -p
create database wordpress;
show databases;</code></pre>
</li>
<li><p>备份nginx的配置文件</p>
<pre><code class="language-shell">cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.bak</code></pre>
</li>
<li><p>修改配置文件</p>
<pre><code class="language-shell">vim /etc/nginx/conf.d/default.conf</code></pre>
</li>
</ul>
<p>重启Nginx服务时候报错，查看错误日志</p>
<pre><code class="language-shell">vim /var/log/nginx/error.log
2018/11/14 17:15:23 [emerg] 14151#0: bind() to 0.0.0.0:80 failed (98: Address already in use)
2018/11/14 17:15:23 [emerg] 14151#0: bind() to [::]:80 failed (98: Address already in use)
2018/11/14 17:15:23 [emerg] 14151#0: bind() to 0.0.0.0:80 failed (98: Address already in use)
2018/11/14 17:15:23 [emerg] 14151#0: bind() to [::]:80 failed (98: Address already in use)
2018/11/14 17:15:23 [emerg] 14151#0: bind() to 0.0.0.0:80 failed (98: Address already in use)
2018/11/14 17:15:23 [emerg] 14151#0: bind() to [::]:80 failed (98: Address already in use)
2018/11/14 17:15:23 [emerg] 14151#0: bind() to 0.0.0.0:80 failed (98: Address already in use)
2018/11/14 17:15:23 [emerg] 14151#0: bind() to [::]:80 failed (98: Address already in use)
2018/11/14 17:15:23 [emerg] 14151#0: bind() to 0.0.0.0:80 failed (98: Address already in use)
2018/11/14 17:15:23 [emerg] 14151#0: bind() to [::]:80 failed (98: Address already in use)
2018/11/14 17:15:23 [emerg] 14151#0: still could not bind()</code></pre>
<p>看错误信息提示80端口已经被占用，无法重启Nginx服务，查看80端口进程是哪一个，并kill掉后，重启服务成功</p>
<pre><code class="language-shell">netstat -ntpl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 127.0.0.1:9000          0.0.0.0:*               LISTEN      11333/php-fpm: mast
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      10363/nginx: master
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      15636/sshd
tcp6       0      0 :::3306                 :::*                    LISTEN      10604/mysqld
tcp6       0      0 :::80                   :::*                    LISTEN      10363/nginx: master
kill 10363
service nginx restart</code></pre>
<ul>
<li>访问域名后显示WP的安装，我们点击进行填写mysql的用户名和密码</li>
</ul>
<p>数据用户名和密码填写后报错</p>
<blockquote>
<p>抱歉，我不能写入wp-config.php文件 ......</p>
</blockquote>
<p>查看wordpress文件夹，发现是权限问题</p>
<pre><code class="language-shell">ll /home | grep wordpress
drwxr-xr-x 5 nobody 65534 4096 2月   8 2018 wordpress</code></pre>
<ul>
<li>查看用户组</li>
</ul>
<pre><code class="language-shell">grep -E &#39;^(user|group)&#39; /etc/php-fpm.d/www.conf
user = apache
group = apache</code></pre>
<ul>
<li>设置访问权限</li>
</ul>
<pre><code class="language-shell">chown -R apache:apache /home/wordpress</code></pre>
<h1 id="再次访问成功！">再次访问成功！</h1><p>参开链接：<br><a href="https://laravel-china.org/articles/10803/this-weekend-theres-a-lot-of-pits-on-the-website-for-a-friend-to-do">https://laravel-china.org/articles/10803/this-weekend-theres-a-lot-of-pits-on-the-website-for-a-friend-to-do</a><br><a href="https://blog.csdn.net/u011475134/article/details/80222098">https://blog.csdn.net/u011475134/article/details/80222098</a><br><a href="https://laravel-china.org/articles/17377#296073">https://laravel-china.org/articles/17377#296073</a></p>

            </div>
          </article>
        </div>
    
        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="VickStar.coding.me/post/fu-meng">
              <h3 class="post-title">
                伏梦
              </h3>
            </a>
          </div>  
        

        
    
        <div class="site-footer">
  Powered by Hve Notes, © 2017 - 2019 Copyright 张阿简. All Rights Reserved.
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
